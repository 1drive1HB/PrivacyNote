# AI-Generated Documentation for PrivacyNote

This document provides a detailed breakdown of the PrivacyNote project, generated by an AI assistant. It covers the project's architecture, file-by-file analysis, application flow, and recommendations for improvement.

## 1. Project Overview

**PrivacyNote** is a secure, client-side web application for creating self-destructing notes. It uses vanilla JavaScript for the frontend, Supabase for the backend, and Cloudflare Turnstile for bot protection. The application is designed with privacy and security in mind, offering client-side encryption and configurable note expiration.

## 2. File Breakdown

### Root Directory

-   **`.gitignore`**: Specifies files and directories that Git should ignore. This is well-configured to exclude sensitive information like `env.json` and local development directories.
-   **`GEMINI.md`**: The previous analysis of the project.
-   **`AI_docs.md`**: This document.
-   **`future_tasks.md`**: A list of recommended tasks and improvements for the project.
-   **`index.html`**: The main entry point of the application, where users can create new notes.
-   **`note.html`**: The page where users can view a created note. The note is retrieved from the backend and displayed here.
-   **`readme.md`**: The project's README file, containing a general overview and setup instructions.

### `.github/workflows`

-   **`static.yml`**: This GitHub Actions workflow automates the deployment of the application to GitHub Pages. On every push to the `main` branch, it creates a production `src/js/config.js` file with secrets and deploys the project.

### `src/css`

-   **`base.css`**: Contains base styles for the application, such as resets and global variables.
-   **`components.css`**: Styles for individual components, like buttons and forms.
-   **`note.css`**: Styles specific to the `note.html` page.
-   **`settings.css`**: Styles for the settings component.
-   **`styles.css`**: The main stylesheet that imports all other CSS files.

### `src/html`

-   **`settings.html`**: The HTML structure for the settings component, which is dynamically loaded into `index.html`.

### `src/js`

-   **`config.js`**: This file is dynamically generated during the deployment process. In local development, it's populated by `load-Env.js`. In production, it's created by the GitHub Actions workflow with secrets. It holds the configuration for Supabase, Cloudflare, and the encryption key.
-   **`load-Env.js`**: This script is used in local development to load environment variables from `env.json` into the `window.__ENV` object, which is then used by `config.js`.
-   **`main.js`**: The main JavaScript file for `index.html`. It initializes the application, loads the settings, and handles user interactions.

#### `src/js/actions`

-   **`cryptoActions.js`**: This module contains the logic for encrypting and decrypting note content using the Web Crypto API (AES-256).
-   **`noteAction.js`**: This script is the entry point for the `note.html` page. It retrieves the note ID from the URL, fetches the note from the backend, decrypts it if necessary, and displays it to the user.
-   **`noteQuery.js`**: This module is responsible for all communication with the Supabase backend. It contains functions for creating and retrieving notes.
-   **`settingsUI.js`**: This module manages the settings UI, including loading the HTML, initializing the accordion and radio buttons, and handling the character counter.

#### `src/js/services`

-   **`domApp_service.js`**: This service provides utility functions for DOM manipulation, such as getting elements, toggling button states, and showing feedback messages.
-   **`noteApp_service.js`**: This service contains the core application logic for creating notes. It gets the user's settings, calls the `noteQuery.js` module to create the note, and then displays the generated link.
-   **`supabase.js`**: This module initializes and exports the Supabase client.
-   **`turnstile.js`**: This service manages the integration with Cloudflare Turnstile for bot protection.
-   **`whatsappUI.js`**: This module handles the "Share via WhatsApp" functionality.

## 3. Application Flow

1.  **Initialization**: When a user opens `index.html`, `main.js` initializes the application. It loads the settings UI from `src/html/settings.html` and sets up event listeners.
2.  **Configuration**: In a local environment, `load-Env.js` fetches the configuration from `env.json`. In production, `config.js` is already populated with secrets by the deployment workflow.
3.  **Note Creation**:
    -   The user types a note, selects encryption and expiration settings, and clicks "Create Secure Note".
    -   `noteApp_service.js` is called, which gets the current settings.
    -   If encryption is enabled, `cryptoActions.js` is used to encrypt the note content.
    -   `noteQuery.js` sends the note (either encrypted or in plain text) to the Supabase backend.
    -   A unique URL for the note is generated and displayed to the user.
4.  **Note Viewing**:
    -   When a user opens a note URL, `note.html` is loaded.
    -   `noteAction.js` extracts the note ID from the URL.
    -   `noteQuery.js` retrieves the note from Supabase.
    -   If the note was encrypted, `cryptoActions.js` is used to decrypt it.
    -   The note content is displayed, and the note is marked as read in the database, which effectively destroys it.

## 4. Deployment

The application is deployed to GitHub Pages via the `.github/workflows/static.yml` workflow. The workflow is triggered on every push to the `main` branch. The most critical step in the workflow is the creation of the `src/js/config.js` file, where the production secrets are injected. This is a secure way to handle sensitive information without committing it to the repository.
